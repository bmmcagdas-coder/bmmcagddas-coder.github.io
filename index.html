<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Bildirim KaydÄ± - Staj Takip</title>
    <script>
    (function (w, d, s, id) {
        if (typeof (w.webpushr) !== 'undefined') return;
        w.webpushr = w.webpushr || function () { (w.webpushr.q = w.webpushr.q || []).push(arguments); };
        var js, fjs = d.getElementsByTagName(s)[0];
        js = d.createElement(s); js.id = id; js.async = 1;
        js.src = "https://cdn.webpushr.com/app.min.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(window, document, 'script', 'webpushr-jssdk'));

    webpushr('setup', { 
        'key': 'BCAqoBi7PifomzI8rpkbs2lxqKu1LrWNJCfOf22kC8BPbejb-_XKTe9ZK9SgOLt54U9RDZ4cX7-XzP5dr3ckVWc' 
    });

    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('uid');

    // FONKSÄ°YON: Etiketi Webpushr'a gÃ¶nderir
    function tagUser() {
        if (userId) {
            webpushr('attributes', { "user_id": userId.toString() });
            console.log("Etiketleme denendi: " + userId);
        }
    }

    // 1. Sayfa aÃ§Ä±ldÄ±ktan 3 saniye sonra gÃ¶nder (Zaten aboneyse Ã§alÄ±ÅŸÄ±r)
    window.onload = function() {
        setTimeout(tagUser, 3000);
    };

    // 2. KullanÄ±cÄ± "Ä°zin Ver" dediÄŸi an gÃ¶nder (Yeni aboneler iÃ§in en garantisi)
    webpushr('onNotificationPromptAction', function(action) {
        if (action === 'allow') {
            setTimeout(tagUser, 1000); // Ä°zin sonrasÄ± 1 sn bekle ve etiketle
            document.getElementById('status-text').innerHTML = "<b style='color:green;'>Ä°ÅŸlem BaÅŸarÄ±lÄ±!</b><br>KaydÄ±nÄ±z yapÄ±ldÄ±. Bu pencere 5 saniye iÃ§inde kapanacaktÄ±r.";
            setTimeout(() => { window.close(); }, 5000);
        }
    });
    </script>
</head>
<body style="text-align:center; font-family:sans-serif; padding-top:50px; background-color:#f4f4f4;">
    <div style="background:white; padding:30px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); display:inline-block; max-width:90%; width: 400px;">
        <h2 style="color:#2ecc71;">ğŸ”” Duyuru KaydÄ±</h2>
        <p id="status-text">Bildirimleri aktif etmek iÃ§in butona basÄ±n ve <b>"Ä°zin Ver"</b> deyin.</p>
        <div id="webpushr-subscription-button" data-button-text="BÄ°LDÄ°RÄ°MLERÄ° AKTÄ°F ET" data-background-color="#2ecc71" data-color="#ffffff"></div>
    </div>
</body>
</html>
